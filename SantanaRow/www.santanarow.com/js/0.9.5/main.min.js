_DEBUG = !1;
var sr = sr || function() {
	return sr = {
		js: {
			version: "0.9.5",
			scripttype: "min"
		},
		els: {},
		settings: {
			mapboxname: "santanarow.sr-directory"
		}
	}, sr.allowddnav = !1, sr
}();
jQuery(document).ready(function(a) {
	function b(a) {
		_DEBUG && console.warn("loaded js: " + a)
	}

	if (_templatetype === 'home') {
		initSocialFeedCarousels();
		alignHomePage();
		$(window).resize(function() {
			alignHomePage();
		});
		fixHomeForTabletPortrait();
		$(window).resize(function() {
			fixHomeForTabletPortrait();
		});
	}

	_$els = sr.els, _$els.window = a(window), _$els.html = a("html"), selectnav("conNav"), selectnav("footNav", {
		label: "Links"
	}), selectnav("searchNav", {
		label: "Results Section"
	}), a.each(a("[id^=selectnav]"), function() {
		a(this).ddslick({
			width: "100%",
			highlightTitle: !0,
			onSelected: function(b) {
				var c = b.selectedData.value;
				if (sr.allowddnav) {
					if (_DEBUG && console.warn("need JS for naviation to " + c), -1 != c.indexOf("#emailSignUp")) return a("#emailModal").click(), void 0;
					if (-1 != c.indexOf("#languageSelect")) return a("#langModal").click(), void 0;
					if (-1 != c.indexOf("#tab-")) {
						var d = c.substr(c.indexOf("#tab-") + 1);
						return a('li[rel="' + d + '"]').click(), void 0
					}
					c && (window.location.href = c)
				}
			}
		})
	}), sr.allowddnav = !0, _$els.window.resize(function() {
		var b = window.innerHeight ? window.innerHeight : _$els.window.height(),
			c = 800 >= b,
			d = 670 >= b;
		a("html").toggleClass("viewport-short", c), a("html").toggleClass("viewport-veryshort", d), a(".container-header").height(window.innerHeight ? window.innerHeight : a(window).height())
	}).resize();
	var c = ["nav", "social-drawer", "search-drawer"],
		d = function(b) {
			_DEBUG && console.log("-----\ntoggle menu:" + b.data.menu);
			var d = b.data.menu;
			_$els.html.toggleClass(d + "-open");
			var e = c.clone();
			e.splice(a.inArray(d, c), 1);
			for (var f = e.length - 1; f >= 0; f--) _$els.html.removeClass(e[f] + "-open");
			"function" == typeof b.data.func && b.data.func(_$els.html.hasClass(d + "-open")), Modernizr.mq("(max-width: 48em)") || (_$els.html.hasClass(d + "-open") ? (_DEBUG && console.log("adding mask"), a("#mask").length ? a("#mask") : a('<div id="mask">').hide().prependTo(".container-main"), a("#mask").fadeIn("slow")) : (_DEBUG && console.log("removing mask"), a("#mask").fadeOut("slow", function() {
				a(this).remove()
			}))), b.preventDefault()
		};
	a("#menuToggle").on("click", {
			menu: "nav"
		}, d), a(".socialToggle").on("click", {
			menu: "social-drawer",
			func: function() {
				Modernizr.mq("(max-width: 48em)") || a("#socialDrawer").css({
					top: a("#leftSocialToggle").position().top + "px"
				})
			}
		}, d), a(".tab-wrapper").tabsystem(), a("#searchSubmit").on("click", function(b) {
			b.preventDefault(), a(this).parent("form").submit()
		}), a("#searchForm").submit(function(b) {
			var c = a(this).find("#keywords").val();
			if (!c) return !1;
			c = c.toLowerCase();
			var d = {
				spa: "/shop#v-g&f-salon_spa",
				hotel: "/concierge/hotel/",
				"hotel valencia": "/concierge/hotel/",
				"store hours": "/concierge",
				movies: "/concierge",
				"movie theater": "/concierge",
				jobs: "/concierge/careers/"
			};
			for (var e in d) 0 == e.indexOf(c) && (b.preventDefault(), window.location.href = d[e])
		}),
		/* Snapchat modal
		a("#snapchat-lightbox-trigger, .snapchat-lightbox-trigger").click(function(e) {
			e.preventDefault();

			var modalTop = 200;
			var isMobile = a(window).width() < 769 ? true : false;

			if (isMobile) {
				modalTop = 25;

				//   Open snapchat - scheme or url
				window.location = '//www.snapchat.com/add/lifeontherow';
				return;
			}

			// is Desktop
			a('#snapchatModal').css({
				'display': 'block',
				'position': 'fixed',
				'opacity': 0,
				'z-index': 11000,
				'left': 50 + '%',
				'margin-left': -(a('#snapchatModal').outerWidth() / 2) + "px",
				'top': modalTop + "px"
			}).fadeTo(200, 1);
			a('#lean_overlay').css({
				'display': 'block',
				opacity: 0
			});
			a('#lean_overlay').fadeTo(200, 0.5);
			// Close modal on overlay click
			a('#lean_overlay, .close-modal').click(function(e) {
				e.preventDefault();

				$('#lean_overlay').fadeOut(200);
				$('#snapchatModal').css({
					'display': 'none'
				});
			});
		}),
		*/
		a("#langModal").leanModal({}), a(".open_email_dialog").on("click", function(b) {
			b.preventDefault(), a("#emailModal").click()
		}), a("#emailModal").leanModal({
			closeButton: "#modal_close"
		}), a("#submitEmailSignup").on("click", function(b) {
			b.preventDefault();
			var c = a("#subForm"),
				d = a("input#duidih-duidih"),
				e = a("input#name"),
				f = a("#emailMessage");
			return e.removeClass("error"), d.removeClass("error"), "" == e.val() ? (e.addClass("error").focus(), !1) : "" == d.val() ? (d.addClass("error").focus(), !1) : (a.ajax({
				url: c.attr("action"),
				type: "POST",
				dataType: "jsonp",
				data: c.serialize(),
				success: function(b, c) {
					_DEBUG && console.warn(c), _DEBUG && console.warn(b);
					var g = b.Status;
					return 200 == g && (f.text("Thank you!").fadeIn(), setTimeout(function() {
						f.fadeOut(), a("#modal_close").click(), e.val(""), d.val("")
					}, 3e3)), 400 == g && (f.text("Please enter a valid email").fadeIn(), d.addClass("error").focus(), setTimeout(function() {
						f.fadeOut()
					}, 3e3)), !0
				},
				error: function(a, b, c) {
					alert("Something seems to have gone wrong. Error: " + c)
				}
			}), void 0)
		}), a("input[type=checkbox]").on("click", function() {
			_DEBUG && console.log("checking box: " + a(this).is(":checked")), a(this).toggleClass("checked", a(this).is(":checked"))
		}), a("#pageShareToggle").click(function(b) {
			b.preventDefault(), a(".addthis_toolbox").toggleClass("show")
		});
	var e = "/js/" + sr.js.version + "/lib/" + sr.js.scripttype,
		f = "/js/" + sr.js.version + "/comp/" + sr.js.scripttype,
		g = {
			global: e + "/global." + sr.js.scripttype + ".lib.js",
			sequence: e + "/slider." + sr.js.scripttype + ".lib.js",
			touch: e + "/touch." + sr.js.scripttype + ".lib.js",
			mapbox: e + "/mapbox." + sr.js.scripttype + ".lib.js",
			grid: e + "/grid." + sr.js.scripttype + ".lib.js"
		},
		h = {
			grid: f + "/grid." + sr.js.scripttype + ".js",
			hero: f + "/hero." + sr.js.scripttype + ".js",
			map: f + "/map." + sr.js.scripttype + ".js",
			touch: f + "/touch." + sr.js.scripttype + ".js",
			"tmpl-split": f + "/tmpl-split." + sr.js.scripttype + ".js",
			"tmpl-vendor": f + "/tmpl-vendor." + sr.js.scripttype + ".js"
		};
	"home" == _templatetype && (
		// initSocialFeedCarousels(),
		// alignHomePage(),
		// $(window).resize(function() {
		// 	alignHomePage()
		// }),
		// fixHomeForTabletPortrait(),
		// $(window).resize(function() {
		// 	fixHomeForTabletPortrait()
		// }),
		a("html").addClass("height100"), yepnope({
			load: [g.sequence, h.hero],
			callback: b
		})
	), "mapfull" == _templatetype && (a("html").addClass("height100"), yepnope({
		load: [g.mapbox, h.map],
		callback: b
	})), "grid" == _templatetype && yepnope({
		load: [g.grid, h.grid],
		callback: b
	}), "split" == _templatetype && yepnope({
		load: [h["tmpl-split"]],
		callback: b
	}), "vendor" == _templatetype && yepnope({
		load: [g.mapbox, h["tmpl-vendor"]],
		callback: b
	}), yepnope({
		test: Modernizr.touch,
		yep: [g.touch, h.touch]
	})
});

function fixHomeForTabletPortrait() {
	// No longer needed css based now
	return;

	if (!$('.page-type-home ').length) {
		return;
	}

	var windowHeight = $(window).height(),
		footerHeight = $('.container-footer').height();

	$('.container-main .desktop-view-height-wrapper').css('height', windowHeight - footerHeight + 'px');
}

function alignHomePage() {
	return;

	var $homepageHero = $('.homepage-hero .hero-content'),
		heroHeight = $homepageHero.outerHeight() / 2;

	if ($(window).width() > 991) {
		$homepageHero.css('margin-top', '-' + heroHeight + 'px');
	} else {
		$homepageHero.css('margin-top', '0px');
	}
};

function initSocialFeedCarousels() {
	// console.log('- initSocialFeedCarousels -');

	var instagramCarousel = $('.social-promo.instagram');
	var twitterCarousel = $('.social-promo.twitter');

	// Default set of options
	var carouselOptions = {
		mouseDrag: false,
		touchDrag: false,
		autoplay: true,
		// autoplayHoverPause: true,
		autoplayTimeout:  8000,
		autoHeight: true,
		loop: true,
		margin: 0,
		nav: false,
		items: 1,
		animateOut: 'fadeOut'
	};

	// Clone carouselOptions for mutations
	var instagramOptions = $.extend({}, carouselOptions);
	var twitterOptions = $.extend({}, carouselOptions);

	instagramCarousel.owlCarousel(instagramOptions);
	twitterCarousel.owlCarousel(twitterOptions);

	// Pause twitter carousel for offset
	twitterCarousel.trigger('stop.owl.autoplay');

	// Offset rotations so that both carousels change at different times
	setTimeout(function() {
		twitterCarousel.trigger('play.owl.autoplay',[8000])
	}, 4000);
}
